# VALO360腳本深度分析報告

## 📋 報告資訊
- **分析日期**: 2025年8月12日
- **分析工具**: 統一腳本分析器 (unified_centimani_script_analyzer.py)
- **分析檔案**: `VALO360_TestFlow_20250318_MB_ER2.xlsx`
- **專案類型**: VALO360主機板功能測試
- **報告版本**: v1.0

## 🎯 腳本概覽

### 基本統計
- **總工作表數**: 6個
- **MB工作表行數**: 159行
- **總命令數**: 172個
- **CLI命令**: 64個 (37.21%)
- **設備調用**: 108個 (62.79%)
- **Phase數量**: 24個
- **複雜度分數**: 69/100

### 工作表結構
1. **Properties**: 基本屬性配置 (3行)
2. **DUTs**: 設備配置 (2行, 18列)
3. **Switch**: 開關配置 (1行, 7列)
4. **Instrument**: 儀器配置 (40行, 9列)
5. **MB**: 主要測試流程 (159行, 256列)
6. **TEMP**: 溫度測試流程 (13行, 256列)

## 🔍 欄位深度分析

### 核心欄位功能解析

#### **Index_149**
- **功能**: 測試步驟序號索引
- **設計邏輯**: 提供執行順序追蹤
- **生成規則**: 從1開始遞增，確保唯一性

#### **Phase**
- **功能**: 測試階段分類控制
- **設計邏輯**: 
  - Phase 0: 系統初始化 (登入、SFIS檢查、網路測試)
  - Phase 1-9: 基本功能測試 (模型識別、硬體測試)
  - Phase 10-19: 進階功能測試 (IMU、按鈕測試)
  - Phase 20+: 特殊測試驗證
- **生成規則**: 按邏輯分組設計，0用於初始化

#### **Title**
- **功能**: 測試項目描述標題
- **設計邏輯**: 提供人類可讀的測試描述
- **生成規則**: 使用清晰英文描述，說明測試動作和目標

#### **Send**
- **功能**: 執行命令或指令
- **設計邏輯**: 
  - CLI命令: 與DUT通訊 (如 "UART@diag -s sku N3C2401C")
  - 設備調用: 控制測試設備 (如 ":Delay,\"2000\"")
- **生成規則**: 根據測試需求選擇命令類型

#### **Reply**
- **功能**: 預期回應驗證
- **設計邏輯**: 確保命令執行成功
- **生成規則**: 使用@符號表示包含匹配

#### **Ref**
- **功能**: 變數存儲和數據傳遞
- **設計邏輯**: 實現測試步驟間的數據共享
- **生成規則**: 全域變數使用$前綴，區域變數使用普通名稱

#### **Validation**
- **功能**: 結果範圍驗證
- **設計邏輯**: 自動判斷PASS/FAIL
- **生成規則**: 格式 "(變數名,格式,下限,上限)"

#### **ExecMode**
- **功能**: 執行模式控制
- **設計邏輯**: 
  - 0: 正常模式
  - 1: 總是執行
  - 2: 重試模式
  - 4: 條件執行
  - 6: 失敗時執行
  - 8: SFIS啟用時執行
- **生成規則**: 根據測試邏輯需求選擇

## 🧠 腳本邏輯深度理解

### Phase 0: 系統初始化階段

#### **登入流程 (行2-13)**
```
2: :ShowISN,"*(ISN)"           # 顯示ISN號碼
3: :Disconnect,"UART"          # 斷開UART連接
4: :SfCheckRoute               # SFIS路由檢查
5: :ShowConfirmBox,"you need SD and SIM","YES"  # 確認SD和SIM卡
6: UARTF@G\r\n                 # 治具通訊測試
7: UARTF@F\r\n                 # 治具通訊測試
8: :Delay,"1000"               # 延遲1秒
9: :Utility.PING,"*$(DUTIP_1)","60000","{0}"  # 網路連線測試
10: :Delay,"2000"              # 延遲2秒
11: :Connect,"UART"            # 重新連接UART
12: UART@\r\n                  # 發送換行
13: UART@diag -s sku *$(sfisSKU)\r\n  # 設定SKU
```

#### **設計邏輯分析**
- **順序性**: 先斷開再重連，確保連接狀態清晰
- **確認機制**: 使用ShowConfirmBox確認必要硬體
- **網路驗證**: 使用PING測試網路連線
- **延遲控制**: 適當延遲確保操作完成

### Phase 1-9: 基本功能測試階段

#### **模型識別邏輯 (行14-43)**
```
14: :GetVal,"$G_VALO360_MODEL"  # 獲取模型變數
15: :GetVal,"$G_VALO360_MODEL"  # 驗證模型變數
16: :SetModelName,"N3C2401C"    # 設定5G模型
17: :GetModelName               # 驗證模型設定
18: UART@diag -s sku N3C2401C\r\n  # 設定SKU
19: :Delay,"2000"               # 延遲2秒
20: UART@diag -g sku\r\n        # 讀取SKU
21: :Delay,"0"                  # 無延遲
...
```

#### **設計邏輯分析**
- **變數管理**: 使用全域變數$G_VALO360_MODEL管理模型狀態
- **設定驗證**: 每次設定後都有對應的驗證步驟
- **時序控制**: 使用Delay控制操作節奏
- **狀態檢查**: 通過UART命令檢查硬體狀態

### Phase 10+: 進階功能測試階段

#### **IMU測試邏輯**
```
# IMU磁力計自檢
: 執行 imu mag selftest 命令
: 驗證 @SELFTEST:PASS 回應

# IMU狀態檢查
: 執行 imu mag status 命令
: 驗證 @ECOMPASS:PASS 回應
```

#### **按鈕測試邏輯**
```
# 硬體按鈕測試
: 使用 :ShowConfirmBox 提示操作
: 使用 :Delay 控制測試節奏
: 通過SSH檢查按鈕狀態
```

## 📋 新腳本生成規則

### 1. 欄位結構設計原則

#### **必要欄位順序**
```
Index → Phase → Title → Marco → Instrument → Switch → Send → Reply → EndPrompt → Ref → Validation → Prompt → Waiting → ExecMode → Description → TestID
```

#### **Phase設計規則**
- **Phase 0**: 系統初始化 (登入、檢查、準備)
- **Phase 1-9**: 基本功能測試 (識別、配置、基本驗證)
- **Phase 10-19**: 進階功能測試 (特殊功能、複雜驗證)
- **Phase 20+**: 特殊測試 (邊界測試、壓力測試)

### 2. 命令類型選擇策略

#### **CLI命令使用場景**
- 與DUT通訊
- 讀取硬體狀態
- 設定硬體參數
- 執行診斷命令

#### **設備調用使用場景**
- 控制測試設備
- 執行系統功能
- 管理變數和狀態
- 控制測試流程

### 3. 變數管理策略

#### **全域變數設計**
- 使用$前綴識別
- 用於跨Phase數據共享
- 存儲系統配置信息
- 管理測試狀態

#### **區域變數設計**
- 使用普通名稱
- 用於單一測試步驟
- 存儲測試結果
- 臨時數據存儲

### 4. 驗證機制設計

#### **Validation格式規範**
```
(變數名,格式,下限,上限)
格式類型: %f(浮點數), %d(整數), %s(字串)
```

#### **驗證策略**
- 數值範圍驗證
- 字串內容驗證
- 狀態碼驗證
- 回應時間驗證

### 5. 執行控制邏輯

#### **ExecMode選擇指南**
- **0**: 正常執行模式 (預設)
- **1**: 總是執行 (關鍵步驟)
- **2**: 重試模式 (不穩定操作)
- **4**: 條件執行 (分支邏輯)
- **6**: 失敗時執行 (錯誤處理)
- **8**: SFIS啟用時執行 (生產環境)

## 🔧 實用工具和參考

### 腳本分析工具
- **統一腳本分析器**: `unified_centimani_script_analyzer.py`
- **功能**: 深度分析腳本結構、識別邏輯模式、生成分析報告

### 腳本生成工具
- **統一腳本生成器**: `unified_centimani_script_generator.py`
- **功能**: 生成新腳本、修改現有腳本、創建配置檔案

### 參考文件
- **腳本編輯速查表**: `Centimani_Script_Editing_Complete_Quick_Reference.md`
- **AI使用指南**: `AI_USAGE_GUIDE.md`
- **腳本生成邏輯**: `AI_SCRIPT_GENERATION_LOGIC_REFERENCE.md`

## 📊 腳本品質評估

### 優點
1. **結構清晰**: Phase設計合理，邏輯分組明確
2. **變數管理**: 全域變數使用得當，數據傳遞順暢
3. **錯誤處理**: ExecMode設計完善，支援多種執行模式
4. **驗證機制**: Validation欄位使用充分，自動化程度高

### 改進建議
1. **Marco使用**: 可以增加宏定義，減少重複代碼
2. **錯誤處理**: 可以增加更多的錯誤處理邏輯
3. **日誌記錄**: 可以增加詳細的執行日誌記錄

## 🎯 總結

VALO360腳本是一個設計良好的主機板功能測試腳本，具有以下特點：

1. **完整的測試流程**: 從系統初始化到功能測試的完整覆蓋
2. **靈活的執行控制**: 支援多種執行模式和條件邏輯
3. **完善的驗證機制**: 自動化的結果驗證和判斷
4. **清晰的變數管理**: 合理的變數設計和數據傳遞

這個腳本為VALO360專案的腳本開發提供了優秀的參考範例，其設計模式和最佳實踐值得在其他專案中推廣應用。

---

*本報告基於VALO360_TestFlow_20250318_MB_ER2.xlsx腳本檔案，使用統一腳本分析器進行深度分析，為腳本開發和維護提供實用參考。* 